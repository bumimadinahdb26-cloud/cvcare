<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVC Early Warning System v2.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=IBM+Plex+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/driver.js@1.0.1/dist/driver.css"/>
    <script src="https://cdn.jsdelivr.net/npm/driver.js@1.0.1/dist/driver.js.iife.js"></script>
    
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f0fdfa;
            --accent-teal: #0d9488;
            --accent-green: #10b981;
            --accent-purple: #8b5cf6;
            --accent-gold: #c9a227;
            --warning-yellow: #fbbf24;
            --warning-orange: #f97316;
            --danger-red: #ef4444;
            --success-green: #22c55e;
            --border-color: #d1fae5;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'IBM Plex Sans', sans-serif;
            background: linear-gradient(135deg, #f0fdfa 0%, #ffffff 50%, #f5f3ff 100%);
            color: #134e4a;
            min-height: 100vh;
            overflow-x: hidden;
        }

        h1, h2, h3, h4 { font-family: 'Space Grotesk', sans-serif; }

        .bg-blob {
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.4;
            z-index: -1;
        }
        .blob-1 { width: 600px; height: 600px; background: #ccfbf1; top: -200px; left: -200px; }
        .blob-2 { width: 500px; height: 500px; background: #ede9fe; bottom: -150px; right: -150px; }

        .header {
            background: rgba(255, 255, 255, 0.98);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 1000; /* Increased Z-index for header */
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(13, 148, 136, 0.05);
        }

        .header-logo-img { height: 42px; width: auto; object-fit: contain; }

        .lang-switcher {
            display: flex;
            background: #f8fafc;
            border-radius: 999px;
            padding: 4px;
            border: 1px solid var(--border-color);
        }

        .lang-btn {
            padding: 6px 16px;
            border-radius: 999px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            background: transparent;
            color: #0f766e;
        }

        .lang-btn.active {
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-green));
            color: white;
        }

        .nav-tab {
            padding: 12px 20px;
            background: transparent;
            border: none;
            color: #0f766e;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            white-space: nowrap;
        }

        .nav-tab::after {
            content: '';
            position: absolute;
            bottom: 0; left: 0;
            width: 100%; height: 3px;
            background: linear-gradient(90deg, var(--accent-teal), var(--accent-purple));
            transform: scaleX(0);
            transition: transform 0.3s ease;
            border-radius: 3px 3px 0 0;
        }

        .nav-tab:hover { color: #134e4a; }
        .nav-tab.active { color: var(--accent-teal); }
        .nav-tab.active::after { transform: scaleX(1); }

        .card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px -10px rgba(13, 148, 136, 0.1);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px -10px rgba(139, 92, 246, 0.15);
        }

        .card-header {
            background: linear-gradient(90deg, rgba(240, 253, 250, 1) 0%, rgba(255, 255, 255, 1) 100%);
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .symptom-checkbox { display: none; }

        .symptom-label {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px 16px;
            background: #fcfcfc;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .symptom-label:hover {
            background: #f0fdfa;
            border-color: var(--accent-teal);
        }

        .symptom-checkbox:checked + .symptom-label {
            background: #f0fdfa;
            border-color: var(--accent-teal);
            box-shadow: 0 0 0 2px rgba(13, 148, 136, 0.1);
        }

        .checkbox-indicator {
            width: 22px; height: 22px;
            min-width: 22px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .symptom-checkbox:checked + .symptom-label .checkbox-indicator {
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-green));
            border-color: transparent;
        }

        .checkbox-indicator svg {
            opacity: 0;
            transform: scale(0);
            transition: all 0.2s ease;
            stroke: white;
        }

        .symptom-checkbox:checked + .symptom-label .checkbox-indicator svg {
            opacity: 1;
            transform: scale(1);
        }

        .risk-meter {
            height: 10px;
            background: #f3f4f6;
            border-radius: 5px;
            overflow: hidden;
        }

        .risk-fill {
            height: 100%;
            border-radius: 5px;
            transition: all 0.5s ease;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 14px;
            border-radius: 999px;
            font-weight: 700;
            font-size: 13px;
        }

        .badge-low { background: #dcfce7; color: #166534; }
        .badge-moderate { background: #fef3c7; color: #854d0e; }
        .badge-high { background: #ffedd5; color: #9a3412; }
        .badge-critical { background: #fee2e2; color: #991b1b; animation: pulse-critical 2s infinite; }

        @keyframes pulse-critical {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(239, 68, 68, 0); }
        }

        .action-btn {
            padding: 14px 28px;
            border-radius: 999px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-green));
            color: white;
            box-shadow: 0 10px 20px -5px rgba(13, 148, 136, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px -5px rgba(13, 148, 136, 0.4);
        }

        .btn-secondary {
            background: white;
            border: 2px solid var(--accent-purple);
            color: var(--accent-purple);
        }

        .btn-secondary:hover {
            background: #f5f3ff;
            transform: translateY(-2px);
        }

        .btn-voice {
            padding: 8px;
            border-radius: 50%;
            background: transparent;
            border: 1px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-voice.active {
            background: rgba(139, 92, 246, 0.1);
            border-color: var(--accent-purple);
        }

        .section { display: none; animation: fadeSlide 0.5s ease; }
        .section.active { display: block; }

        @keyframes fadeSlide {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .progress-ring { transform: rotate(-90deg); }
        .progress-ring-circle { transition: stroke-dashoffset 0.5s ease; }

        .modal-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(8px);
            z-index: 2000; /* Higher than header */
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active { display: flex; }

        .modal-content {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 24px;
            width: 100%;
            max-width: 450px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlide 0.3s ease;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .modal-lg { max-width: 700px; }

        @keyframes modalSlide {
            from { opacity: 0; transform: scale(0.95) translateY(-20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .input-field {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            padding: 12px 16px;
            border-radius: 12px;
            color: #134e4a;
            width: 100%;
            transition: all 0.2s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent-purple);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
            background: white;
        }

        .wa-card-btn {
            padding: 8px 16px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 600;
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .wa-card-btn:hover {
            background: #22c55e;
            color: white;
            border-color: #22c55e;
        }

        .alert-banner {
            padding: 16px 20px;
            border-radius: 16px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            border: 1px solid;
        }

        /* Fixed Dropdown */
        .dropdown-menu {
            position: absolute;
            top: calc(100% + 8px); /* Jarak dari atas */
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 8px;
            min-width: 200px;
            display: none;
            z-index: 1100; /* Z-index di bawah modal tapi di atas konten */
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        }

        .dropdown-menu.active { display: block; }

        .dropdown-item {
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #134e4a;
            font-weight: 500;
        }

        .dropdown-item:hover { background: #f0fdfa; color: var(--accent-teal); }
        .dropdown-item svg { flex-shrink: 0; }

        .avatar {
            width: 40px; height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent-purple);
            background: #f5f3ff;
        }

        .avatar-large {
            width: 100px; height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--accent-purple);
            background: #f5f3ff;
        }

        .signature { font-family: 'Space Grotesk', sans-serif; font-size: 12px; color: #94a3b8; }
        
        .driver-popover {
            background: white !important;
            border: 2px solid var(--accent-teal) !important;
            border-radius: 16px !important;
            box-shadow: 0 25px 50px rgba(13, 148, 136, 0.25) !important;
        }
        .driver-popover-title {
            font-family: 'Space Grotesk', sans-serif !important;
            font-size: 18px !important;
            color: var(--accent-teal) !important;
        }
        .driver-popover-description {
            font-family: 'IBM Plex Sans', sans-serif !important;
            line-height: 1.6 !important;
        }
        .driver-popover-navigation-btns button {
            background: var(--accent-teal) !important;
            text-shadow: none !important;
            border: none !important;
            border-radius: 8px !important;
            padding: 8px 16px !important;
        }
        .driver-popover-navigation-btns button.driver-popover-prev-btn {
            background: white !important;
            border: 1px solid #e5e7eb !important;
            color: #0f766e !important;
        }
        
        .contact-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            transition: all 0.3s;
        }
        
        .contact-card:hover {
            border-color: #22c55e;
            background: #f0fdf4;
        }
        
        .literature-card {
            background: linear-gradient(135deg, #f0fdfa 0%, white 100%);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s;
            display: block;
        }
        
        .literature-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(13, 148, 136, 0.1);
        }
        
        .info-card {
            background: linear-gradient(135deg, #f5f3ff 0%, white 100%);
            border: 1px solid #e9d5ff;
            border-radius: 16px;
            padding: 24px;
        }
        
        .status-connected {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #dcfce7;
            border-radius: 999px;
            color: #166534;
            font-weight: 600;
            font-size: 14px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse-green 2s infinite;
        }
        
        @keyframes pulse-green {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .history-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.2s;
        }
        .history-item:hover {
            border-color: var(--accent-teal);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body>
    <div class="bg-blob blob-1"></div>
    <div class="bg-blob blob-2"></div>

    <!-- Login Modal -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal-content">
            <div class="card-header flex items-center justify-between">
                <h3 class="font-semibold text-gray-800">Login Pasien</h3>
                <button onclick="closeModal('loginModal')" class="p-2 rounded-lg hover:bg-gray-100">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-gray-500">
                        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    <div>
                        <label class="text-xs font-medium mb-2 block text-gray-600">Username</label>
                        <input type="text" class="input-field" id="loginUsername" placeholder="Masukkan username">
                    </div>
                    <div>
                        <label class="text-xs font-medium mb-2 block text-gray-600">Password</label>
                        <input type="password" class="input-field" id="loginPassword" placeholder="Masukkan password">
                    </div>
                    <button class="action-btn btn-primary w-full justify-center" onclick="handleLogin()">Login</button>
                    <p class="text-center text-sm text-gray-500">
                        Belum punya akun? 
                        <a href="#" onclick="switchModal('loginModal', 'registerModal'); return false;" class="text-teal-600 font-semibold hover:underline">Daftar disini</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal-overlay" id="registerModal">
        <div class="modal-content">
            <div class="card-header flex items-center justify-between">
                <h3 class="font-semibold text-gray-800">Daftar Pasien Baru</h3>
                <button onclick="closeModal('registerModal')" class="p-2 rounded-lg hover:bg-gray-100">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-gray-500">
                        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="p-6">
                <div class="text-center mb-6">
                    <div class="relative inline-block">
                        <img id="previewPhoto" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2'%3E%3Cpath d='M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2'/%3E%3Ccircle cx='12' cy='7' r='4'/%3E%3C/svg%3E" class="avatar-large mb-2">
                        <label class="absolute bottom-0 right-0 w-8 h-8 rounded-full flex items-center justify-center cursor-pointer bg-purple-500 hover:bg-purple-600 transition-colors">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                                <circle cx="12" cy="13" r="4"/>
                            </svg>
                            <input type="file" accept="image/*" id="photoInput" class="hidden" onchange="previewImage(this)">
                        </label>
                    </div>
                    <p class="text-xs text-gray-500">Klik untuk upload foto</p>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="text-xs font-medium mb-2 block text-gray-600">Nama Lengkap</label>
                        <input type="text" class="input-field" id="registerName" placeholder="Nama lengkap">
                    </div>
                    <div>
                        <label class="text-xs font-medium mb-2 block text-gray-600">Username</label>
                        <input type="text" class="input-field" id="registerUsername" placeholder="Buat username">
                    </div>
                    <div>
                        <label class="text-xs font-medium mb-2 block text-gray-600">Password</label>
                        <input type="password" class="input-field" id="registerPassword" placeholder="Buat password">
                    </div>
                    <div>
                        <label class="text-xs font-medium mb-2 block text-gray-600">No. HP</label>
                        <input type="tel" class="input-field" id="registerPhone" placeholder="Contoh: 081234567890">
                    </div>
                    <button class="action-btn btn-primary w-full justify-center" onclick="handleRegister()">Daftar</button>
                    <p class="text-center text-sm text-gray-500">
                        Sudah punya akun? 
                        <a href="#" onclick="switchModal('registerModal', 'loginModal'); return false;" class="text-teal-600 font-semibold hover:underline">Login disini</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Info Modal -->
    <div class="modal-overlay" id="infoModal">
        <div class="modal-content modal-lg">
            <div class="card-header flex items-center justify-between bg-gradient-to-r from-teal-50 to-purple-50">
                <h3 class="font-semibold text-teal-700 text-lg">Informasi Aplikasi</h3>
                <button onclick="closeModal('infoModal')" class="p-2 rounded-lg hover:bg-white/50">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-gray-500">
                        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="p-6">
                <div class="text-center mb-6">
                    <img src="https://raw.githubusercontent.com/bumimadinahdb26-cloud/cvcare/main/logo.png" alt="Logo" class="h-20 mx-auto mb-4" onerror="this.style.display='none'">
                    <h2 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-teal-600 to-purple-600">CVC Early Warning System</h2>
                    <p class="text-gray-500 mt-1">Central Venous Catheter Early Warning System</p>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="info-card">
                        <p class="text-xs text-gray-500 uppercase tracking-wider">Versi</p>
                        <p class="text-2xl font-bold text-teal-600">2.1.0</p>
                    </div>
                    <div class="info-card">
                        <p class="text-xs text-gray-500 uppercase tracking-wider">Tahun Pembuatan</p>
                        <p class="text-2xl font-bold text-purple-600">2026</p>
                    </div>
                </div>
                
                <div class="info-card mb-6">
                    <h4 class="font-semibold text-gray-800 mb-2">Tujuan Aplikasi</h4>
                    <p class="text-sm text-gray-600 leading-relaxed">
                        Aplikasi ini dirancang untuk membantu tenaga medis dalam melakukan deteksi dini terhadap komplikasi pada pasien dengan Central Venous Catheter (CVC). 
                        Sistem ini memberikan penilaian risiko berdasarkan tanda-tanda infeksi dan gangguan aliran darah, sehingga penanganan dapat dilakukan secara cepat dan tepat.
                        Hasil penilaian terintegrasi langsung dengan database spreadsheet untuk memudahkan pencatatan dan monitoring.
                    </p>
                </div>
                
                <div class="info-card">
                    <h4 class="font-semibold text-gray-800 mb-2">Pengembang</h4>
                    <p class="text-sm text-gray-600">Iman Waluyo</p>
                    <p class="text-xs text-gray-400 mt-1">Based on NIH, NKF KDOQI, CDC Guidelines</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header relative z-10" id="header-section">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between flex-wrap gap-3">
                <div class="flex items-center gap-3 cursor-pointer" onclick="openModal('infoModal')">
                    <img 
                        src="https://raw.githubusercontent.com/bumimadinahdb26-cloud/cvcare/main/logo.png" 
                        alt="Logo CVC" 
                        class="header-logo-img"
                        onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 24 24\' fill=\'none\' stroke=\'%230d9488\' stroke-width=\'2\'%3E%3Ccircle cx=\'12\' cy=\'12\' r=\'10\'/%3E%3Cpath d=\'M12 6v6l4 2\'/%3E%3C/svg%3E'; this.style.width='40px'; this.style.height='40px';"
                    >
                    <div>
                        <h1 class="text-lg sm:text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-teal-600 to-purple-600">CVC Early Warning System</h1>
                        <p class="text-xs text-gray-500">Sistem Peringatan Dini Kateter</p>
                    </div>
                </div>
                
                <div class="flex items-center gap-2 sm:gap-3">
                    <div class="lang-switcher hidden sm:flex">
                        <button class="lang-btn active" id="langId" onclick="setLanguage('id')">ID</button>
                        <button class="lang-btn" id="langEn" onclick="setLanguage('en')">EN</button>
                    </div>
                    
                    <!-- Tombol Panduan & Contoh (Dipindah ke sini) -->
                    <button onclick="startTour()" class="btn-voice" title="Panduan & Contoh">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#0d9488" stroke-width="2">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                        </svg>
                    </button>

                    <button onclick="toggleVoice()" id="voiceBtn" class="btn-voice" title="Aktifkan Suara">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#8b5cf6" stroke-width="2">
                            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                            <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                            <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
                        </svg>
                    </button>
                    
                    <div id="loggedOutState" class="flex items-center gap-2">
                        <button onclick="openModal('loginModal')" class="action-btn btn-secondary text-sm py-2 px-4">Login</button>
                        <button onclick="openModal('registerModal')" class="action-btn btn-primary text-sm py-2 px-4 hidden sm:flex">Daftar</button>
                    </div>
                    
                    <div id="loggedInState" class="hidden relative">
                        <div class="flex items-center gap-3 cursor-pointer" onclick="toggleDropdown()">
                            <div class="text-right hidden sm:block">
                                <p class="text-sm font-semibold text-gray-800" id="headerUserName">Nama Pasien</p>
                                <p class="text-xs text-gray-400" id="headerTime">--:--</p>
                            </div>
                            <img id="headerAvatar" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2'%3E%3Cpath d='M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2'/%3E%3Ccircle cx='12' cy='7' r='4'/%3E%3C/svg%3E" class="avatar">
                        </div>
                        <div class="dropdown-menu" id="userDropdown">
                            <div class="dropdown-item" onclick="openModal('infoModal')">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <line x1="12" y1="16" x2="12" y2="12"/>
                                    <line x1="12" y1="8" x2="12.01" y2="8"/>
                                </svg>
                                <span>Info Aplikasi</span>
                            </div>
                            <div class="dropdown-item" onclick="switchTab('riwayat')">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                <span>Riwayat Saya</span>
                            </div>
                            <div class="dropdown-item" onclick="handleLogout()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                                    <polyline points="16 17 21 12 16 7"/>
                                    <line x1="21" y1="12" x2="9" y2="12"/>
                                </svg>
                                <span>Keluar</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="relative z-10 border-b border-gray-200 bg-white/80 backdrop-blur-sm">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex gap-1 overflow-x-auto py-2">
                <button class="nav-tab active" data-tab="assessment" onclick="switchTab('assessment')">Penilaian</button>
                <button class="nav-tab" data-tab="results" onclick="switchTab('results')">Hasil</button>
                <button class="nav-tab" data-tab="panduan" onclick="switchTab('panduan')">Panduan & Referensi</button>
                <button class="nav-tab" data-tab="privacy" onclick="switchTab('privacy')">Privasi</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="relative z-10 max-w-7xl mx-auto px-4 py-6">
        
        <!-- Assessment Section -->
        <div id="assessment-section" class="section active">
            <div class="card mb-6" id="patient-data-card">
                <div class="card-header">
                    <h3 class="font-semibold text-teal-700">Data Pasien</h3>
                </div>
                <div class="p-5">
                    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                        <div>
                            <label class="text-xs font-medium mb-2 block text-gray-500">ID Pasien</label>
                            <input type="text" class="input-field" id="patientId" placeholder="ID Pasien">
                        </div>
                        <div>
                            <label class="text-xs font-medium mb-2 block text-gray-500">Nama Pasien</label>
                            <input type="text" class="input-field" id="patientName" placeholder="Nama Lengkap">
                        </div>
                        <div>
                            <label class="text-xs font-medium mb-2 block text-gray-500">Usia</label>
                            <input type="number" class="input-field" id="patientAge" placeholder="Tahun">
                        </div>
                        <div>
                            <label class="text-xs font-medium mb-2 block text-gray-500">Instalasi</label>
                            <select class="input-field" id="instalasi">
                                <option value="">Pilih...</option>
                                <option value="RAWAT INAP">Rawat Inap</option>
                                <option value="ICU">ICU</option>
                                <option value="ICCU">ICCU</option>
                                <option value="IGD">IGD</option>
                                <option value="HEMODIALISA">Hemodialisa</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs font-medium mb-2 block text-gray-500">Ruang</label>
                            <input type="text" class="input-field" id="ruang" placeholder="No. Ruang">
                        </div>
                        <div>
                            <label class="text-xs font-medium mb-2 block text-gray-500">Lama Terpasang</label>
                            <input type="number" class="input-field" id="daysInserted" placeholder="Hari">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                        <div>
                            <label class="text-xs font-medium mb-2 block text-gray-500">Lokasi Kateter</label>
                            <select class="input-field" id="cvcLocation">
                                <option value="internal-jugular">Leher (Internal Jugular)</option>
                                <option value="femoral">Paha (Femoral)</option>
                                <option value="subclavian">Dada (Subclavian)</option>
                            </select>
                        </div>
                        <div class="flex items-end gap-4">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="diabetes" onchange="calculateRisk()" class="w-4 h-4 text-teal-600 rounded">
                                <span class="text-sm text-gray-700">Diabetes</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="lowAlbumin" onchange="calculateRisk()" class="w-4 h-4 text-teal-600 rounded">
                                <span class="text-sm text-gray-700">Albumin Rendah</span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="immunocompromised" onchange="calculateRisk()" class="w-4 h-4 text-teal-600 rounded">
                                <span class="text-sm text-gray-700">Imun Lemah</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card" id="infection-card">
                    <div class="card-header flex items-center justify-between flex-wrap gap-2">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center bg-red-100">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-800">Tanda-Tanda Infeksi</h3>
                                <p class="text-xs text-gray-500">Cek di sekitar kateter</p>
                            </div>
                        </div>
                        <span class="badge badge-low" id="infectionBadge">Low</span>
                    </div>
                    <div class="p-5">
                        <h4 class="text-sm font-semibold mb-3 text-gray-600 uppercase tracking-wider">Infeksi Lokal</h4>
                        <div class="space-y-3 mb-6">
                            <input type="checkbox" class="symptom-checkbox" id="erythema" onchange="calculateRisk()">
                            <label class="symptom-label" for="erythema"><span class="checkbox-indicator"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></span><div><span class="font-medium text-gray-800">Kemerahan di Kulit</span><p class="text-xs mt-1 text-gray-500">Ada bercak merah di sekitar kateter</p></div></label>
                            <input type="checkbox" class="symptom-checkbox" id="swelling" onchange="calculateRisk()">
                            <label class="symptom-label" for="swelling"><span class="checkbox-indicator"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></span><div><span class="font-medium text-gray-800">Bengkak / Terasa Hangat</span><p class="text-xs mt-1 text-gray-500">Bagian sekitar kateter membengkak</p></div></label>
                            <input type="checkbox" class="symptom-checkbox" id="purulent" onchange="calculateRisk()">
                            <label class="symptom-label" for="purulent"><span class="checkbox-indicator"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></span><div><span class="font-medium text-gray-800">Keluar Nanah</span><p class="text-xs mt-1 text-gray-500">Ada cairan kuning atau hijau</p></div></label>
                            <input type="checkbox" class="symptom-checkbox" id="tenderness" onchange="calculateRisk()">
                            <label class="symptom-label" for="tenderness"><span class="checkbox-indicator"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></span><div><span class="font-medium text-gray-800">Nyeri bila Ditekan</span><p class="text-xs mt-1 text-gray-500">Terasa sakit saat ditekan</p></div></label>
                            <input type="checkbox" class="symptom-checkbox" id="tunnelInfection" onchange="calculateRisk()">
                            <label class="symptom-label" for="tunnelInfection"><span class="checkbox-indicator"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></span><div><span class="font-medium text-gray-800">Infeksi Jalur Bawah Kulit</span><p class="text-xs mt-1 text-gray-500">Merah sepanjang jalur kateter</p></div></label>
                        </div>
                        <h4 class="text-sm font-semibold mb-3 text-gray-600 uppercase tracking-wider">Infeksi Sistemik</h4>
                        <div class="space-y-3">
                            <input type="checkbox" class="symptom-checkbox" id="fever" onchange="calculateRisk()">
                            <label class="symptom-label" for="fever"><span class="checkbox-indicator"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></span><div><span class="font-medium text-gray-800">Demam (>38 C)</span><p class="text-xs mt-1 text-gray-500">Badan panas atau menggigil</p></div></label>
                            <input type="checkbox" class="symptom-checkbox" id="chills" onchange="calculateRisk()">
                            <label class="symptom-label" for="chills"><span class="checkbox-indicator"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></span><div><span class="font-medium text-gray-800">Menggigil Hebat</span><p class="text-xs mt-1 text-gray-500">Gemetar tak tertahankan</p></div></label>
                            <input type="checkbox" class="symptom-checkbox" id="hypotension" onchange="calculateRisk()">
                            <label class="symptom-label" for="hypotension"><span class="checkbox-indicator"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></span><div><span class="font-medium text-gray-800">Tekanan Darah Rendah</span><p class="text-xs mt-1 text-gray-500">TD < 90 mmHg</p></div></label>
                            <input type="checkbox" class="symptom-checkbox" id="leukocytosis" onchange="calculateRisk()">
                            <label class="symptom-label" for="leukocytosis"><span class="checkbox-indicator"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></span><div><span class="font-medium text-gray-800">Leukosit Tinggi</span><p class="text-xs mt-1 text-gray-500">Hasil lab leukosit tinggi</p></div></label>
                            <input type="checkbox" class="symptom-checkbox" id="malaise" onchange="calculateRisk()">
                            <label class="symptom-label" for="malaise"><span class="checkbox-indicator"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></span><div><span class="font-medium text-gray-800">Lemas / Tidak Enak Badan</span><p class="text-xs mt-1 text-gray-500">Merasa lelah dan tidak bertenaga</p></div></label>
                        </div>
                    </div>
                </div>

                <div class="card" id="dysfunction-card">
                    <div class="card-header flex items-center justify-between flex-wrap gap-2">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center bg-orange-100">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#f97316" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-800">Gangguan Aliran Darah</h3>
                                <p class="text-xs text-gray-500">Masalah pada kateter</p>
                            </div>
                        </div>
                        <span class="badge badge-low" id="dysfunctionBadge">Low</span>
                    </div>
                    <div class="p-5">
                        <h4 class="text-sm font-semibold mb-3 text-gray-600 uppercase tracking-wider">Masalah Aliran</h4>
                        <div class="space-y-3 mb-6">
                            <input type="checkbox" class="symptom-checkbox" id="lowFlow" onchange="calculateRisk()">
                            <label class="symptom-label" for="lowFlow"><span class="checkbox-indicator"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></span><div><span class="font-medium text-gray-800">Aliran Darah Lambat</span><p class="text-xs mt-1 text-gray-500">Mesin sering bunyi alarm</p></div></label>
                            <input type="checkbox" class="symptom-checkbox" id="arterialAlarm" onchange="calculateRisk()">
                            <label class="symptom-label" for="arterialAlarm"><span class="checkbox-indicator"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></span><div><span class="font-medium text-gray-800">Alarm Tarikan Darah</span><p class="text-xs mt-1 text-gray-500">Alarm saat menarik darah</p></div></label>
                            <input type="checkbox" class="symptom-checkbox" id="venousAlarm" onchange="calculateRisk()">
                            <label class="symptom-label" for="venousAlarm"><span class="checkbox-indicator"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></span><div><span class="font-medium text-gray-800">Alarm Kembalinya Darah</span><p class="text-xs mt-1 text-gray-500">Alarm saat mengembalikan darah</p></div></label>
                        </div>
                        <h4 class="text-sm font-semibold mb-3 text-gray-600 uppercase tracking-wider">Tanda Sumbatan</h4>
                        <div class="space-y-3">
                            <input type="checkbox" class="symptom-checkbox" id="flushDifficulty" onchange="calculateRisk()">
                            <label class="symptom-label" for="flushDifficulty"><span class="checkbox-indicator"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></span><div><span class="font-medium text-gray-800">Susah Disuntik Cairan</span><p class="text-xs mt-1 text-gray-500">Ada hambatan saat menyuntik</p></div></label>
                            <input type="checkbox" class="symptom-checkbox" id="positionDependent" onchange="calculateRisk()">
                            <label class="symptom-label" for="positionDependent"><span class="checkbox-indicator"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></span><div><span class="font-medium text-gray-800">Aliran Berubah Saat Bergerak</span><p class="text-xs mt-1 text-gray-500">Aliran berubah saat ubah posisi</p></div></label>
                            <input type="checkbox" class="symptom-checkbox" id="visibleClot" onchange="calculateRisk()">
                            <label class="symptom-label" for="visibleClot"><span class="checkbox-indicator"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></span><div><span class="font-medium text-gray-800">Ada Gumpalan Darah</span><p class="text-xs mt-1 text-gray-500">Gumpalan terlihat di selang</p></div></label>
                            <input type="checkbox" class="symptom-checkbox" id="recirculation" onchange="calculateRisk()">
                            <label class="symptom-label" for="recirculation"><span class="checkbox-indicator"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></span><div><span class="font-medium text-gray-800">Resirkulasi Tinggi</span><p class="text-xs mt-1 text-gray-500">Perlu cek lebih lanjut</p></div></label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-6 flex flex-wrap gap-4 justify-center">
                <button class="action-btn btn-primary" onclick="calculateRisk()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="4" y="4" width="16" height="16" rx="2"/>
                        <path d="M9 9h6M9 12h6M9 15h4"/>
                    </svg>
                    Hitung Skor Risiko
                </button>
                <button class="action-btn btn-secondary" onclick="resetForm()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                        <path d="M3 3v5h5"/>
                    </svg>
                    Reset
                </button>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results-section" class="section">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="card lg:col-span-1">
                    <div class="card-header"><h3 class="font-semibold text-teal-700">Skor Risiko Total</h3></div>
                    <div class="p-6 text-center">
                        <div class="relative inline-block mb-4">
                            <svg class="progress-ring" width="160" height="160">
                                <circle cx="80" cy="80" r="70" fill="none" stroke="#f3f4f6" stroke-width="12"/>
                                <circle id="progressCircle" class="progress-ring-circle" cx="80" cy="80" r="70" fill="none" stroke="#22c55e" stroke-width="12" stroke-linecap="round" stroke-dasharray="439.8" stroke-dashoffset="439.8"/>
                            </svg>
                            <div class="absolute inset-0 flex flex-col items-center justify-center">
                                <span class="text-5xl font-bold text-gray-800" id="totalScore">0</span>
                                <span class="text-sm text-gray-500">poin</span>
                            </div>
                        </div>
                        <div id="overallBadge" class="badge badge-low justify-center w-full">LOW RISK</div>
                        <p class="mt-4 text-sm text-gray-600" id="riskSummary">Pasien tidak menunjukkan tanda-tanda masalah pada kateter.</p>
                    </div>
                </div>

                <div class="card lg:col-span-2">
                    <div class="card-header"><h3 class="font-semibold text-teal-700">Rincian Faktor Risiko</h3></div>
                    <div class="p-5">
                        <div class="space-y-4">
                            <div><div class="flex justify-between items-center mb-2"><span class="text-sm font-medium text-gray-700">Risiko Infeksi</span><span class="text-sm font-semibold text-red-500" id="infectionScoreDisplay">0/15</span></div><div class="risk-meter"><div class="risk-fill bg-emerald-400" id="infectionBar" style="width: 0%;"></div></div></div>
                            <div><div class="flex justify-between items-center mb-2"><span class="text-sm font-medium text-gray-700">Risiko Gangguan Aliran</span><span class="text-sm font-semibold text-orange-500" id="dysfunctionScoreDisplay">0/14</span></div><div class="risk-meter"><div class="risk-fill bg-orange-400" id="dysfunctionBar" style="width: 0%;"></div></div></div>
                            <div><div class="flex justify-between items-center mb-2"><span class="text-sm font-medium text-gray-700">Faktor Risiko Pasien</span><span class="text-sm font-semibold text-purple-500" id="patientScoreDisplay">0/8</span></div><div class="risk-meter"><div class="risk-fill bg-purple-400" id="patientBar" style="width: 0%;"></div></div></div>
                        </div>
                        <div class="mt-6">
                            <h4 class="text-sm font-semibold mb-3 text-gray-600">Temuan</h4>
                            <div id="findingsList" class="space-y-2"><p class="text-sm text-gray-400 italic">Belum ada temuan.</p></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recommendations -->
            <div class="card mt-6">
                <div class="card-header"><h3 class="font-semibold text-teal-700">Saran Tindakan</h3></div>
                <div class="p-5"><div id="recommendations" class="space-y-4"></div></div>
            </div>

            <!-- SEND REPORT SECTION -->
            <div class="card mt-6 border-purple-200 bg-gradient-to-r from-purple-50 to-teal-50">
                <div class="card-header border-purple-100">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center bg-purple-100">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="#8b5cf6"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.94 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.372-.025-.52-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479c0 1.462 1.065 2.875 1.213 3.074.149.198 2.095 3.2 5.076 4.487 1.054.453 1.875.709 2.51.903.999.306 1.905.26 2.623.159.801-.112 2.468-1.009 2.817-1.984.349-.976.349-1.81.245-1.984-.074-.124-.272-.198-.57-.347z"/></svg>
                            </div>
                            <div>
                                <h3 class="font-semibold text-purple-800">Kirim Laporan</h3>
                                <p class="text-xs text-purple-600">Kirim hasil penilaian ke tim medis & database</p>
                            </div>
                        </div>
                        <div class="status-connected">
                            <span class="status-dot"></span>
                            Database Terhubung
                        </div>
                    </div>
                </div>
                <div class="p-5">
                    <!-- Perawat Contacts -->
                    <h4 class="text-sm font-semibold text-gray-700 mb-3">Perawat</h4>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-4">
                        <div class="contact-card">
                            <div class="flex items-center gap-3">
                                <div class="w-9 h-9 rounded-full bg-green-100 flex items-center justify-center text-green-600 font-bold text-sm">R</div>
                                <div>
                                    <p class="font-semibold text-gray-800 text-sm">Riza</p>
                                    <p class="text-xs text-gray-500">082227707573</p>
                                </div>
                            </div>
                            <button onclick="sendWhatsApp('6282227707573')" class="wa-card-btn text-xs">Kirim</button>
                        </div>
                        <div class="contact-card">
                            <div class="flex items-center gap-3">
                                <div class="w-9 h-9 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold text-sm">P</div>
                                <div>
                                    <p class="font-semibold text-gray-800 text-sm">Pembayun</p>
                                    <p class="text-xs text-gray-500">083831217784</p>
                                </div>
                            </div>
                            <button onclick="sendWhatsApp('6283831217784')" class="wa-card-btn text-xs">Kirim</button>
                        </div>
                        <div class="contact-card">
                            <div class="flex items-center gap-3">
                                <div class="w-9 h-9 rounded-full bg-pink-100 flex items-center justify-center text-pink-600 font-bold text-sm">H</div>
                                <div>
                                    <p class="font-semibold text-gray-800 text-sm">Hesty</p>
                                    <p class="text-xs text-gray-500">082124700093</p>
                                </div>
                            </div>
                            <button onclick="sendWhatsApp('6282124700093')" class="wa-card-btn text-xs">Kirim</button>
                        </div>
                        <div class="contact-card">
                            <div class="flex items-center gap-3">
                                <div class="w-9 h-9 rounded-full bg-yellow-100 flex items-center justify-center text-yellow-600 font-bold text-sm">R</div>
                                <div>
                                    <p class="font-semibold text-gray-800 text-sm">Rinda</p>
                                    <p class="text-xs text-gray-500">085210622568</p>
                                </div>
                            </div>
                            <button onclick="sendWhatsApp('6285210622568')" class="wa-card-btn text-xs">Kirim</button>
                        </div>
                        <div class="contact-card">
                            <div class="flex items-center gap-3">
                                <div class="w-9 h-9 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 font-bold text-sm">I</div>
                                <div>
                                    <p class="font-semibold text-gray-800 text-sm">Iman</p>
                                    <p class="text-xs text-gray-500">087812203039</p>
                                </div>
                            </div>
                            <button onclick="sendWhatsApp('6287812203039')" class="wa-card-btn text-xs">Kirim</button>
                        </div>
                    </div>
                    
                    <!-- Dokter Contacts -->
                    <h4 class="text-sm font-semibold text-gray-700 mb-3">Dokter</h4>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <div class="contact-card border-red-200 bg-red-50/30">
                            <div class="flex items-center gap-3">
                                <div class="w-9 h-9 rounded-full bg-red-100 flex items-center justify-center text-red-600 font-bold text-sm">dr</div>
                                <div>
                                    <p class="font-semibold text-gray-800 text-sm">dr. Achmad Rifai, Sp.PD-KGH</p>
                                    <p class="text-xs text-gray-500">081252651083</p>
                                </div>
                            </div>
                            <button onclick="sendWhatsApp('6281252651083')" class="wa-card-btn text-xs bg-red-100 text-red-700 border-red-200 hover:bg-red-500 hover:text-white">Kirim</button>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="mt-4 pt-4 border-t border-gray-200 grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <button onclick="sendToSpreadsheet()" class="action-btn btn-primary w-full justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                            </svg>
                            Simpan ke Database Spreadsheet
                        </button>
                        
                        <button onclick="saveToHistory()" class="action-btn btn-secondary w-full justify-center">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                <polyline points="17 21 17 13 7 13 7 21"/>
                                <polyline points="7 3 7 8 15 8"/>
                            </svg>
                            Simpan ke Akun Saya
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Riwayat Section -->
        <div id="riwayat-section" class="section">
            <div class="card">
                <div class="card-header flex justify-between items-center">
                    <h3 class="font-semibold text-teal-700">Riwayat Assesmen Saya</h3>
                    <button onclick="clearHistory()" class="text-red-500 text-sm hover:underline">Hapus Semua</button>
                </div>
                <div class="p-6" id="historyContainer">
                    <p class="text-gray-500 text-center">Belum ada riwayat tersimpan.</p>
                </div>
            </div>
        </div>

        <!-- Panduan & Referensi Section -->
        <div id="panduan-section" class="section">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <!-- Infection Protocol -->
                <div class="card">
                    <div class="card-header"><h3 class="font-semibold text-gray-800">Panduan Infeksi</h3></div>
                    <div class="p-5 space-y-4">
                        <div class="p-4 bg-red-50 border-l-4 border-red-400 rounded-r-lg">
                            <h4 class="font-semibold text-red-700">1. Tindakan Segera</h4>
                            <ul class="text-sm mt-2 space-y-1 text-gray-700 list-disc list-inside">
                                <li>Hubungi dokter ginjal segera</li>
                                <li>Hentikan pemberian heparin</li>
                                <li>Siapkan sampel kultur darah</li>
                            </ul>
                        </div>
                        <div class="p-4 bg-orange-50 border-l-4 border-orange-400 rounded-r-lg">
                            <h4 class="font-semibold text-orange-700">2. Pemeriksaan</h4>
                            <ul class="text-sm mt-2 space-y-1 text-gray-700 list-disc list-inside">
                                <li>Kultur darah dari kateter & perifer</li>
                                <li>Hitung darah lengkap</li>
                                <li>CRP & Procalcitonin</li>
                            </ul>
                        </div>
                        <div class="p-4 bg-green-50 border-l-4 border-green-400 rounded-r-lg">
                            <h4 class="font-semibold text-green-700">3. Pengobatan</h4>
                            <ul class="text-sm mt-2 space-y-1 text-gray-700 list-disc list-inside">
                                <li>Antibiotik sesuai hasil kultur</li>
                                <li>Antibiotic lock therapy</li>
                                <li>Pertimbangkan pencabutan kateter</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Dysfunction Protocol -->
                <div class="card">
                    <div class="card-header"><h3 class="font-semibold text-gray-800">Panduan Gangguan Aliran</h3></div>
                    <div class="p-5 space-y-4">
                        <div class="p-4 bg-purple-50 border-l-4 border-purple-400 rounded-r-lg">
                            <h4 class="font-semibold text-purple-700">1. Manajemen Awal</h4>
                            <ul class="text-sm mt-2 space-y-1 text-gray-700 list-disc list-inside">
                                <li>Reposisi pasien</li>
                                <li>Swap arterial-venous line</li>
                                <li>Flush dengan saline 10-20ml</li>
                            </ul>
                        </div>
                        <div class="p-4 bg-teal-50 border-l-4 border-teal-400 rounded-r-lg">
                            <h4 class="font-semibold text-teal-700">2. Thrombolytic Therapy</h4>
                            <ul class="text-sm mt-2 space-y-1 text-gray-700 list-disc list-inside">
                                <li>tPA (Alteplase) lock 2mg/2ml</li>
                                <li>Dwell time 30-60 menit</li>
                                <li>Dapat diulang 1x</li>
                            </ul>
                        </div>
                        <div class="p-4 bg-blue-50 border-l-4 border-blue-400 rounded-r-lg">
                            <h4 class="font-semibold text-blue-700">3. Evaluasi Lanjutan</h4>
                            <ul class="text-sm mt-2 space-y-1 text-gray-700 list-disc list-inside">
                                <li>Fistulogram jika persisten</li>
                                <li>Evaluasi fibrin sheath</li>
                                <li>Pertimbangkan kateter exchange</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Literature References Updated -->
            <div class="card mb-6">
                <div class="card-header"><h3 class="font-semibold text-teal-700">Literatur & Referensi Resmi</h3></div>
                <div class="p-5">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Ref 1 -->
                        <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC8640568/" target="_blank" class="literature-card block">
                            <div class="flex items-start gap-4">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center flex-shrink-0">
                                    <span class="text-white font-bold text-lg">1</span>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-800 text-sm leading-tight">Central Venous Catheters for Hemodialysisthe Myth and the Evidence</h4>
                                    <p class="text-xs text-gray-500 mt-1">PMC / NIH</p>
                                </div>
                            </div>
                        </a>
                        
                        <!-- Ref 2 -->
                        <a href="https://www.bcrenal.ca/resource-gallery/Documents/CVC-Initiation_of_Dialysis.pdf" target="_blank" class="literature-card block">
                            <div class="flex items-start gap-4">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center flex-shrink-0">
                                    <span class="text-white font-bold text-lg">2</span>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-800 text-sm leading-tight">Hemodialysis Central Venous CVC (CVC): Initiation of Dialysis</h4>
                                    <p class="text-xs text-gray-500 mt-1">BC Renal Agency (PDF)</p>
                                </div>
                            </div>
                        </a>
                        
                        <!-- Ref 3 -->
                        <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC8856770/" target="_blank" class="literature-card block">
                            <div class="flex items-start gap-4">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center flex-shrink-0">
                                    <span class="text-white font-bold text-lg">3</span>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-800 text-sm leading-tight">KDOQI 2019 Vascular Access Guidelines: What Is New</h4>
                                    <p class="text-xs text-gray-500 mt-1">PMC / NIH</p>
                                </div>
                            </div>
                        </a>
                        
                        <!-- Ref 4 -->
                        <a href="https://kemkes.go.id/app_asset/file_content_download/17012287246566b0b4923e55.23821494.pdf" target="_blank" class="literature-card block">
                            <div class="flex items-start gap-4">
                                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center flex-shrink-0">
                                    <span class="text-white font-bold text-lg">4</span>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-800 text-sm leading-tight">Keputusan Menteri Kesehatan (Hal 34)</h4>
                                    <p class="text-xs text-gray-500 mt-1">Kemkes Go ID (PDF)</p>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Video Section -->
            <div class="card">
                <div class="card-header">
                    <h3 class="font-semibold text-teal-700">Video Edukasi Perawatan CVC</h3>
                </div>
                <div class="p-5">
                    <div class="aspect-video bg-gray-100 rounded-xl overflow-hidden flex items-center justify-center">
                         <!-- Menggunakan Google Drive Embed Preview -->
                        <iframe src="https://drive.google.com/file/d/16_RQIDh7VcxzXJw_-dmkdnAANP0pZg8x/preview" width="100%" height="100%" allow="autoplay" class="rounded-xl"></iframe>
                    </div>
                    <p class="text-center text-xs text-gray-500 mt-3">Video Panduan Perawatan CVC</p>
                </div>
            </div>
        </div>

        <!-- Privacy Policy Section -->
        <div id="privacy-section" class="section">
            <div class="card">
                <div class="card-header">
                    <h3 class="font-semibold text-teal-700">Kebijakan Privasi</h3>
                </div>
                <div class="p-6 prose prose-sm max-w-none">
                    <div class="space-y-6 text-gray-700">
                        <div>
                            <h4 class="font-semibold text-gray-900 text-lg">1. Pendahuluan</h4>
                            <p class="mt-2">CVC Early Warning System ("Aplikasi") berkomitmen untuk melindungi privasi pengguna. Kebijakan Privasi ini menjelaskan bagaimana kami mengumpulkan, menggunakan, dan melindungi informasi Anda.</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-900 text-lg">2. Informasi yang Dikumpulkan</h4>
                            <p class="mt-2">Aplikasi ini mengumpulkan informasi berikut:</p>
                            <ul class="list-disc list-inside mt-2 space-y-1">
                                <li>Data identitas pasien (nama, ID pasien, usia)</li>
                                <li>Informasi medis terkait kateter vena sentral</li>
                                <li>Data penilaian risiko dan temuan klinis</li>
                                <li>Kontak tim medis untuk keperluan laporan</li>
                            </ul>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-900 text-lg">3. Penyimpanan Data</h4>
                            <p class="mt-2">Data pasien disimpan secara lokal pada perangkat pengguna (localStorage) dan terintegrasi dengan Google Spreadsheet instansi kesehatan. Kami tidak menyimpan data di server pihak ketiga.</p>
                        </div>
                        
                        <div class="pt-4 border-t border-gray-200">
                            <p class="text-sm text-gray-500">Terakhir diperbarui: Januari 2026</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="relative z-10 mt-12 py-6 border-t border-gray-200 bg-white/50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                <div class="flex items-center gap-3">
                    <img src="https://raw.githubusercontent.com/bumimadinahdb26-cloud/cvcare/main/logo.png" alt="Logo" class="h-8 w-auto opacity-60" onerror="this.style.display='none'">
                    <p class="text-sm text-gray-600 font-medium">CVC Early Warning System v2.1</p>
                </div>
                <div class="signature">
                    <span>2026 | Created by Iman Waluyo</span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // ==================== KONFIGURASI ====================
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxl-fqugmRI92spOhrVmQ-nyEHiyRJUMQwpJQm12ITo4JZdUBOaliXaQ9GR6bYdzSO5TA/exec';
        var currentLang = 'id';
        var currentUser = null;
        var photoDataUrl = null;
        var infectionScore = 0;
        var dysfunctionScore = 0;
        var patientRiskScore = 0;
        var durationScore = 0;
        var voiceEnabled = false;
        var speechSynthesis = window.speechSynthesis;
        var isDemoRunning = false;

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            updateTime();
            setInterval(updateTime, 1000);
            loadUser();
            loadHistory();
            calculateRisk();
        });

        // ==================== TOUR & DEMO COMBINED ====================
        const driver = window.driver.js.driver;

        function startTour() {
            if (isDemoRunning) return;
            isDemoRunning = true;
            
            // Aktifkan suara saat tour mulai
            if(!voiceEnabled) toggleVoice(); 

            const driverObj = driver({
                showProgress: true,
                animate: true,
                stagePadding: 10,
                stageRadius: 10,
                popoverClass: 'driver-popover-custom',
                nextBtnText: 'Lanjut',
                prevBtnText: 'Kembali',
                doneBtnText: 'Selesai',
                onDestroyStarted: () => {
                    isDemoRunning = false;
                    driverObj.destroy();
                },
                onHighlightStarted: (element) => {
                    if (voiceEnabled && element) {
                        const texts = {
                            'patient-data-card': 'Langkah pertama, isi data pasien. Sebagai contoh, saya akan mengisi data untuk pasien bernama Alien.',
                            'infection-card': 'Selanjutnya, centang gejala infeksi. Untuk demo ini, kita centang semua gejala sebagai contoh kasus kritis.',
                            'dysfunction-card': 'Kemudian, isi gangguan aliran darah. Saya akan mencentang semua pilihan untuk simulasi skor tinggi.'
                        };
                        
                        if (texts[element.id]) speak(texts[element.id]);

                        // Auto fill data for demo
                        if (element.id === 'patient-data-card') {
                            document.getElementById('patientId').value = 'DM-2026-0001';
                            document.getElementById('patientName').value = 'Alien';
                            document.getElementById('patientAge').value = '97';
                            document.getElementById('instalasi').value = 'ICU';
                            document.getElementById('ruang').value = 'ICU-03';
                            document.getElementById('daysInserted').value = '25';
                            document.getElementById('cvcLocation').value = 'femoral';
                            document.getElementById('diabetes').checked = true;
                            document.getElementById('lowAlbumin').checked = true;
                        } else if (element.id === 'infection-card') {
                             ['erythema', 'swelling', 'purulent', 'tenderness', 'tunnelInfection', 'fever', 'chills', 'hypotension', 'leukocytosis', 'malaise'].forEach(id => {
                                document.getElementById(id).checked = true;
                            });
                        } else if (element.id === 'dysfunction-card') {
                            ['lowFlow', 'arterialAlarm', 'venousAlarm', 'flushDifficulty', 'positionDependent', 'visibleClot'].forEach(id => {
                                document.getElementById(id).checked = true;
                            });
                            calculateRisk();
                        }
                    }
                }
            });

            driverObj.setSteps([
                { element: '#patient-data-card', popover: { title: 'Data Pasien', description: 'Masukkan data pasien. Saya akan mengisi contoh data pasien Alien.' }},
                { element: '#infection-card', popover: { title: 'Tanda Infeksi', description: 'Centang gejala yang ada. (Data contoh sedang diisi)' }},
                { element: '#dysfunction-card', popover: { title: 'Gangguan Aliran', description: 'Centang masalah aliran. (Data contoh sedang diisi)' }}
            ]);

            speak('Selamat datang. Saya akan memandu Anda mengisi form dengan data contoh pasien Alien 97 tahun dengan nilai kritis.');
            driverObj.drive();
        }

        // ==================== VOICE AI ====================
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            document.getElementById('voiceBtn').classList.toggle('active', voiceEnabled);
            if (voiceEnabled) speak('Panduan suara aktif.');
        }

        function speak(text) {
            if (!voiceEnabled || !speechSynthesis) return;
            speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'id-ID';
            utterance.rate = 0.9;
            speechSynthesis.speak(utterance);
        }

        // ==================== SPREADSHEET ====================
        async function sendToSpreadsheet() {
            const totalScore = infectionScore + dysfunctionScore + patientRiskScore + durationScore;
            const riskLevel = getRiskLevel(totalScore);
            
            const data = {
                patientId: document.getElementById('patientId').value || '-',
                patientName: document.getElementById('patientName').value || '-',
                age: document.getElementById('patientAge').value || '-',
                instalasi: document.getElementById('instalasi').value || '-',
                ruang: document.getElementById('ruang').value || '-',
                cvcLocation: document.getElementById('cvcLocation').selectedOptions[0]?.text || '-',
                daysInserted: document.getElementById('daysInserted').value || '-',
                totalScore: totalScore,
                riskLevel: riskLevel.text,
                findings: getFindingsList(),
                comorbidities: getComorbidities()
            };
            
            try {
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = 'Mengirim...';
                btn.disabled = true;
                
                await fetch(WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                btn.innerHTML = 'Terkirim!';
                btn.classList.remove('btn-primary');
                btn.classList.add('bg-green-500', 'text-white');
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.add('btn-primary');
                    btn.classList.remove('bg-green-500', 'text-white');
                    btn.disabled = false;
                }, 2000);
            } catch (error) {
                alert('Gagal mengirim data.');
            }
        }

        // ==================== HISTORY / SAVE TO ACCOUNT ====================
        function saveToHistory() {
            if(!currentUser) {
                alert('Silakan login terlebih dahulu untuk menyimpan riwayat.');
                openModal('loginModal');
                return;
            }

            const totalScore = infectionScore + dysfunctionScore + patientRiskScore + durationScore;
            const record = {
                timestamp: new Date().toLocaleString('id-ID'),
                patientId: document.getElementById('patientId').value || '-',
                patientName: document.getElementById('patientName').value || '-',
                age: document.getElementById('patientAge').value || '-',
                instalasi: document.getElementById('instalasi').value || '-',
                ruang: document.getElementById('ruang').value || '-',
                score: totalScore,
                level: getRiskLevel(totalScore).text
            };

            let history = JSON.parse(localStorage.getItem('cvc_user_history') || '[]');
            history.unshift(record);
            localStorage.setItem('cvc_user_history', JSON.stringify(history));
            
            alert('Hasil berhasil disimpan ke Riwayat Saya.');
            loadHistory();
        }

        function loadHistory() {
            const container = document.getElementById('historyContainer');
            const history = JSON.parse(localStorage.getItem('cvc_user_history') || '[]');
            
            if(history.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">Belum ada riwayat tersimpan.</p>';
                return;
            }

            container.innerHTML = history.map((item, index) => `
                <div class="history-item">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-semibold text-gray-800">${item.patientName} <span class="text-xs text-gray-500">(${item.patientId})</span></p>
                            <p class="text-sm text-gray-500">${item.instalasi} - ${item.ruang}</p>
                        </div>
                        <div class="text-right">
                            <span class="badge badge-${item.level.toLowerCase()}">${item.level}</span>
                            <p class="text-lg font-bold text-teal-600 mt-1">${item.score} Poin</p>
                        </div>
                    </div>
                    <p class="text-xs text-gray-400 mt-2">${item.timestamp}</p>
                </div>
            `).join('');
        }

        function clearHistory() {
            if(confirm('Hapus semua riwayat?')) {
                localStorage.removeItem('cvc_user_history');
                loadHistory();
            }
        }

        function getFindingsList() {
            const findings = [];
            const symptomNames = {
                'erythema': 'Kemerahan', 'swelling': 'Bengkak', 'purulent': 'Nanah',
                'tenderness': 'Nyeri', 'tunnelInfection': 'Infeksi terowongan',
                'fever': 'Demam', 'chills': 'Menggigil', 'hypotension': 'Hipotensi',
                'leukocytosis': 'Leukositosis', 'malaise': 'Lemas',
                'lowFlow': 'Aliran lambat', 'arterialAlarm': 'Alarm arterial',
                'venousAlarm': 'Alarm vena', 'flushDifficulty': 'Sulit flush',
                'positionDependent': 'Posisi tergantung', 'visibleClot': 'Gumpalan'
            };
            Object.keys(symptomNames).forEach(id => {
                if (document.getElementById(id)?.checked) findings.push(symptomNames[id]);
            });
            return findings;
        }

        function getComorbidities() {
            const c = [];
            if (document.getElementById('diabetes').checked) c.push('Diabetes');
            if (document.getElementById('lowAlbumin').checked) c.push('Albumin Rendah');
            if (document.getElementById('immunocompromised').checked) c.push('Imun Lemah');
            return c;
        }

        // ==================== TAB & MODAL ====================
        function switchTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-tab') === tabName) btn.classList.add('active');
            });
            document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
            const target = document.getElementById(tabName + '-section');
            if (target) target.classList.add('active');
            document.getElementById('userDropdown').classList.remove('active');
        }

        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        function switchModal(from, to) { closeModal(from); setTimeout(() => openModal(to), 200); }

        // ==================== USER MANAGEMENT ====================
        function loadUser() {
            const saved = localStorage.getItem('cvcUser');
            if (saved) { currentUser = JSON.parse(saved); showLoggedIn(); }
        }
        
        function showLoggedIn() {
            document.getElementById('loggedOutState').classList.add('hidden');
            document.getElementById('loggedInState').classList.remove('hidden');
            document.getElementById('headerUserName').textContent = currentUser.name;
            if (currentUser.photo) document.getElementById('headerAvatar').src = currentUser.photo;
        }
        
        function showLoggedOut() {
            document.getElementById('loggedOutState').classList.remove('hidden');
            document.getElementById('loggedInState').classList.add('hidden');
        }
        
        function toggleDropdown() { 
            document.getElementById('userDropdown').classList.toggle('active'); 
        }
        
        document.addEventListener('click', function(e) {
            const dd = document.getElementById('userDropdown');
            const li = document.getElementById('loggedInState');
            if (dd && li && !li.contains(e.target)) dd.classList.remove('active');
        });
        
        function handleRegister() {
            const name = document.getElementById('registerName').value.trim();
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value;
            if (!name || !username || !password) { alert('Lengkapi semua field'); return; }
            const users = JSON.parse(localStorage.getItem('cvcUsers') || '[]');
            if (users.find(u => u.username === username)) { alert('Username sudah ada'); return; }
            const newUser = { name, username, password, photo: photoDataUrl };
            users.push(newUser);
            localStorage.setItem('cvcUsers', JSON.stringify(users));
            localStorage.setItem('cvcUser', JSON.stringify(newUser));
            currentUser = newUser;
            showLoggedIn();
            closeModal('registerModal');
            alert('Pendaftaran berhasil!');
        }
        
        function handleLogin() {
            const u = document.getElementById('loginUsername').value.trim();
            const p = document.getElementById('loginPassword').value;
            const users = JSON.parse(localStorage.getItem('cvcUsers') || '[]');
            const user = users.find(x => x.username === u && x.password === p);
            if (user) {
                currentUser = user;
                localStorage.setItem('cvcUser', JSON.stringify(user));
                showLoggedIn();
                closeModal('loginModal');
            } else { alert('Username atau password salah'); }
        }
        
        function handleLogout() {
            localStorage.removeItem('cvcUser');
            currentUser = null;
            showLoggedOut();
        }
        
        function previewImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) { photoDataUrl = e.target.result; document.getElementById('previewPhoto').src = photoDataUrl; };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // ==================== RISK CALCULATION ====================
        function calculateRisk() {
            const local = ['erythema', 'swelling', 'purulent', 'tenderness', 'tunnelInfection'];
            infectionScore = 0;
            local.forEach(i => { if (document.getElementById(i)?.checked) infectionScore += 2; });
            
            const systemic = ['fever', 'chills', 'hypotension', 'leukocytosis', 'malaise'];
            systemic.forEach(i => { if (document.getElementById(i)?.checked) infectionScore += 3; });

            const dys = ['lowFlow', 'arterialAlarm', 'venousAlarm', 'flushDifficulty', 'positionDependent', 'visibleClot', 'recirculation'];
            dysfunctionScore = 0;
            dys.forEach(i => { if (document.getElementById(i)?.checked) dysfunctionScore += 2; });

            patientRiskScore = 0;
            if (document.getElementById('diabetes')?.checked) patientRiskScore += 2;
            if (document.getElementById('lowAlbumin')?.checked) patientRiskScore += 2;
            if (document.getElementById('immunocompromised')?.checked) patientRiskScore += 2;
            if (parseInt(document.getElementById('patientAge')?.value) > 60) patientRiskScore += 1;
            if (document.getElementById('cvcLocation')?.value === 'femoral') patientRiskScore += 2;

            durationScore = 0;
            const days = parseInt(document.getElementById('daysInserted')?.value) || 0;
            if (days > 20) durationScore = 3;
            else if (days > 14) durationScore = 2;
            else if (days > 7) durationScore = 1;

            updateDisplay(infectionScore + dysfunctionScore + patientRiskScore + durationScore);
        }

        function getRiskLevel(total) {
            if (total >= 20) return { text: 'CRITICAL', class: 'badge-critical', summary: 'Kondisi KRITIS! Tindakan medis segera diperlukan.' };
            if (total >= 12) return { text: 'HIGH', class: 'badge-high', summary: 'Risiko TINGGI! Perlu evaluasi dan tindakan cepat.' };
            if (total >= 5) return { text: 'MODERATE', class: 'badge-moderate', summary: 'Risiko SEDANG. Perlu pemantauan ketat.' };
            return { text: 'LOW', class: 'badge-low', summary: 'Risiko RENDAH. Lanjutkan pemantauan rutin.' };
        }

        function updateDisplay(total) {
            document.getElementById('totalScore').textContent = total;
            const circle = document.getElementById('progressCircle');
            const pct = Math.min(total / 42, 1);
            circle.style.strokeDashoffset = 439.8 * (1 - pct);
            const risk = getRiskLevel(total);
            circle.style.stroke = total >= 20 ? '#ef4444' : total >= 12 ? '#f97316' : total >= 5 ? '#fbbf24' : '#22c55e';

            const infRisk = getRiskLevel(infectionScore * 2);
            const infBadge = document.getElementById('infectionBadge');
            infBadge.textContent = infRisk.text;
            infBadge.className = 'badge ' + infRisk.class;

            const dysRisk = getRiskLevel(dysfunctionScore * 2.5);
            const dysBadge = document.getElementById('dysfunctionBadge');
            dysBadge.textContent = dysRisk.text;
            dysBadge.className = 'badge ' + dysRisk.class;

            const overallBadge = document.getElementById('overallBadge');
            overallBadge.textContent = risk.text;
            overallBadge.className = 'badge justify-center w-full ' + risk.class;
            document.getElementById('riskSummary').textContent = risk.summary;

            updateBar('infection', infectionScore, 15);
            updateBar('dysfunction', dysfunctionScore, 14);
            updateBar('patient', patientRiskScore, 8);
            updateFindings();
            updateRecommendations(total);
        }

        function updateBar(cat, score, max) {
            const display = document.getElementById(cat + 'ScoreDisplay');
            const bar = document.getElementById(cat + 'Bar');
            if (display) display.textContent = score + '/' + max;
            if (bar) {
                const pct = (score / max) * 100;
                bar.style.width = pct + '%';
                bar.style.background = pct > 70 ? '#ef4444' : pct > 40 ? '#f97316' : pct > 20 ? '#fbbf24' : '#22c55e';
            }
        }

        function updateFindings() {
            const list = document.getElementById('findingsList');
            const findings = getFindingsList();
            if (findings.length === 0) list.innerHTML = '<p class="text-sm text-gray-400 italic">Belum ada temuan.</p>';
            else list.innerHTML = findings.map(f => `<div class="p-2 bg-gray-50 rounded text-sm text-gray-700">${f}</div>`).join('');
        }

        function updateRecommendations(total) {
            const r = document.getElementById('recommendations');
            const risk = getRiskLevel(total);
            let html = `
                <div class="alert-banner ${total >= 20 ? 'bg-red-50 border-red-200' : total >= 12 ? 'bg-orange-50 border-orange-200' : total >= 5 ? 'bg-yellow-50 border-yellow-200' : 'bg-green-50 border-green-200'}">
                    <svg class="w-6 h-6 ${total >= 20 ? 'text-red-500' : total >= 12 ? 'text-orange-500' : total >= 5 ? 'text-yellow-500' : 'text-green-500'}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
                    <div><p class="font-bold ${total >= 20 ? 'text-red-700' : total >= 12 ? 'text-orange-700' : total >= 5 ? 'text-yellow-700' : 'text-green-700'}">${risk.text} RISK</p><p class="text-sm text-gray-600 mt-1">${risk.summary}</p></div>
                </div>`;
            if (dysfunctionScore > 4) html += `<div class="alert-banner bg-purple-50 border-purple-200 mt-4"><svg class="w-6 h-6 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg><div><p class="font-bold text-purple-700">Gangguan Aliran Terdeteksi</p><p class="text-sm text-gray-600">Pertimbangkan thrombolytic therapy.</p></div></div>`;
            r.innerHTML = html;
        }

        function resetForm() {
            document.querySelectorAll('.symptom-checkbox').forEach(c => c.checked = false);
            document.querySelectorAll('input[type="number"], input[type="text"]').forEach(i => i.value = '');
            document.querySelectorAll('select').forEach(s => s.selectedIndex = 0);
            document.getElementById('diabetes').checked = false;
            document.getElementById('lowAlbumin').checked = false;
            document.getElementById('immunocompromised').checked = false;
            calculateRisk();
        }

        function updateTime() { const el = document.getElementById('headerTime'); if (el) el.textContent = new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }); }

        // ==================== WHATSAPP ====================
        function sendWhatsApp(phoneNumber) {
            const patientName = document.getElementById('patientName').value || 'Unknown';
            const patientId = document.getElementById('patientId').value || '-';
            const age = document.getElementById('patientAge').value || '-';
            const instalasi = document.getElementById('instalasi').value || '-';
            const ruang = document.getElementById('ruang').value || '-';
            const days = document.getElementById('daysInserted').value || '-';
            const location = document.getElementById('cvcLocation').selectedOptions[0]?.text || '-';
            const totalScore = infectionScore + dysfunctionScore + patientRiskScore + durationScore;
            const risk = getRiskLevel(totalScore);
            const findings = getFindingsList().join('\n- ') || 'Tidak ada';
            const comorbidities = getComorbidities().join(', ') || 'Tidak ada';

            const message = `*LAPORAN CVC EWS*\n====================\nID: ${patientId}\nNama: ${patientName}\nUsia: ${age} th\nInstalasi: ${instalasi}\nRuang: ${ruang}\n====================\nLokasi CVC: ${location}\nLama Terpasang: ${days} hari\n====================\n*SKOR: ${totalScore} (${risk.text})*\n\nTemuan:\n- ${findings}\n\nKomorbid: ${comorbidities}\n\nSaran: ${risk.summary}\n====================\nDikirim dari CVC EWS v2.1`;

            window.open(`https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`, '_blank');
        }

        function setLanguage(lang) {
            currentLang = lang;
            document.getElementById('langId').classList.toggle('active', lang === 'id');
            document.getElementById('langEn').classList.toggle('active', lang === 'en');
        }
    </script>
</body>
</html>
