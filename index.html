<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CVC Early Warning System v2.2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #0d9488;
            --primary-dark: #0f766e;
            --accent: #8b5cf6;
            --bg-body: #f8fafc;
            --bg-card: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --success: #10b981;
            --danger: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden; /* Mencegah scroll horizontal */
        }

        /* ================= HEADER ================= */
        .app-header {
            position: sticky;
            top: 0;
            z-index: 50;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            padding: 0 1rem;
        }

        .header-container {
            max-width: 1280px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 80px; /* Tinggi header proporsional */
            gap: 1rem;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .brand-logo {
            height: 48px;
            width: auto;
            object-fit: contain;
        }

        .brand-text h1 {
            font-size: 1.25rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1.2;
        }

        .brand-text p {
            font-size: 0.75rem;
            color: var(--text-muted);
            display: none; /* Sembunyikan di mobile kerapian */
        }
        
        @media (min-width: 640px) {
            .brand-text p { display: block; }
            .brand-text h1 { font-size: 1.5rem; }
        }

        /* ================= NAVIGATION ================= */
        .app-nav {
            background: white;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 80px; /* Di bawah header */
            z-index: 40;
        }

        .nav-container {
            max-width: 1280px;
            margin: 0 auto;
            display: flex;
            padding: 0 0.5rem;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; /* Firefox */
        }
        .nav-container::-webkit-scrollbar { display: none; } /* Chrome */

        .nav-item {
            padding: 1rem 1.25rem;
            color: var(--text-muted);
            font-weight: 600;
            font-size: 0.9rem;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            cursor: pointer;
        }

        .nav-item:hover {
            color: var(--primary);
            background-color: #f0fdfa;
        }

        .nav-item.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        /* ================= MAIN CONTENT ================= */
        .main-content {
            max-width: 1280px;
            margin: 0 auto;
            padding: 1.5rem 1rem 3rem;
            min-height: calc(100vh - 160px); /* Menjaga footer di bawah */
        }

        /* ================= CARDS & SECTIONS ================= */
        .card {
            background: var(--bg-card);
            border-radius: 1rem;
            border: 1px solid var(--border);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.03);
            margin-bottom: 1.5rem;
            overflow: hidden;
        }

        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(to right, #f8fafc, #ffffff);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-title {
            font-weight: 700;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-body {
            padding: 1.5rem;
        }

        /* ================= FORMS ================= */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .form-group label {
            display: block;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 0.375rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            background: #f8fafc;
            font-size: 1rem; /* 16px untuk anti-zoom iOS */
            color: var(--text-main);
            transition: all 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent);
            background: white;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        /* ================= CUSTOM CHECKBOX (Symptom) ================= */
        .symptom-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 0.75rem;
        }

        .check-card {
            position: relative;
            background: #f8fafc;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .check-card:hover {
            border-color: var(--primary);
        }

        .check-card input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .check-card .content {
            padding: 0.875rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            pointer-events: none; /* Agar klik mengenai input */
        }

        .check-icon {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid #cbd5e1;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s;
        }

        .check-card input:checked + .content .check-icon {
            background: var(--primary);
            border-color: var(--primary);
        }
        
        .check-card input:checked + .content .check-icon svg {
            display: block;
        }

        .check-card input:checked + .content {
            background: rgba(13, 148, 136, 0.05);
            color: var(--primary-dark);
        }

        .check-icon svg {
            display: none;
            width: 12px;
            height: 12px;
            stroke: white;
            stroke-width: 3;
        }

        /* ================= BUTTONS ================= */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            width: 100%; /* Full width di mobile */
        }

        @media (min-width: 640px) {
            .btn { width: auto; }
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 14px 0 rgba(13, 148, 136, 0.25);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(13, 148, 136, 0.25);
        }

        .btn-outline {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        
        .btn-outline:hover {
            background: #f0fdfa;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        /* ================= UTILITIES ================= */
        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }
        .badge-low { background: #dcfce7; color: #166534; }
        .badge-moderate { background: #fef3c7; color: #92400e; }
        .badge-high { background: #ffedd5; color: #9a3412; }
        .badge-critical { background: #fee2e2; color: #991b1b; animation: pulse 2s infinite; }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(239, 68, 68, 0); }
        }

        /* ================= MODAL ================= */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(4px);
            z-index: 100;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .modal-backdrop.active { display: flex; }

        .modal-box {
            background: white;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            border-radius: 1.5rem;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ================= DROPDOWN ================= */
        .dropdown {
            position: relative;
        }
        .dropdown-menu {
            position: absolute;
            top: calc(100% + 5px);
            right: 0;
            background: white;
            min-width: 180px;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
            padding: 0.5rem;
            display: none;
            z-index: 60;
        }
        .dropdown-menu.active { display: block; }
        .dropdown-item {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .dropdown-item:hover { background: #f0fdfa; }

        /* ================= SECTION TOGGLE ================= */
        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ================= REPORT CARDS (WhatsApp) ================= */
        .contact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 0.75rem;
        }
        .contact-card {
            background: white;
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .btn-wa {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
            padding: 0.375rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .btn-wa:hover { background: #22c55e; color: white; border-color: #22c55e; }

        /* Progress Ring */
        .progress-ring { transform: rotate(-90deg); }
        .progress-circle { transition: stroke-dashoffset 0.5s ease; }
    </style>
</head>
<body>

    <!-- LOGIN MODAL -->
    <div id="loginModal" class="modal-backdrop">
        <div class="modal-box">
            <div class="card-header">
                <h3 class="font-bold text-gray-800">Login</h3>
                <button onclick="closeModal('loginModal')" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
            </div>
            <div class="card-body space-y-4">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="loginUsername" class="form-input" placeholder="Masukkan username">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" class="form-input" placeholder="Masukkan password">
                </div>
                <button class="btn btn-primary w-full" onclick="handleLogin()">Login</button>
                <p class="text-center text-sm text-gray-500">Belum punya akun? <a href="#" onclick="switchModal('loginModal', 'registerModal')" class="text-teal-600 font-semibold hover:underline">Daftar</a></p>
            </div>
        </div>
    </div>

    <!-- REGISTER MODAL -->
    <div id="registerModal" class="modal-backdrop">
        <div class="modal-box">
            <div class="card-header">
                <h3 class="font-bold text-gray-800">Daftar Akun</h3>
                <button onclick="closeModal('registerModal')" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
            </div>
            <div class="card-body space-y-4">
                <div class="form-group">
                    <label>Nama Lengkap</label>
                    <input type="text" id="registerName" class="form-input" placeholder="Nama Lengkap">
                </div>
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="registerUsername" class="form-input" placeholder="Username unik">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="registerPassword" class="form-input" placeholder="Password">
                </div>
                <div class="form-group">
                    <label>No. HP</label>
                    <input type="tel" id="registerPhone" class="form-input" placeholder="08xxxxxxxxxx">
                </div>
                <button class="btn btn-primary w-full" onclick="handleRegister()">Daftar</button>
                <p class="text-center text-sm text-gray-500">Sudah punya akun? <a href="#" onclick="switchModal('registerModal', 'loginModal')" class="text-teal-600 font-semibold hover:underline">Login</a></p>
            </div>
        </div>
    </div>

    <!-- INFO MODAL -->
    <div id="infoModal" class="modal-backdrop">
        <div class="modal-box">
            <div class="card-header">
                <h3 class="font-bold text-gray-800">Info Aplikasi</h3>
                <button onclick="closeModal('infoModal')" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
            </div>
            <div class="card-body text-center space-y-4">
                <img src="https://raw.githubusercontent.com/bumimadinahdb26-cloud/cvcare/main/logo.png" alt="Logo" class="h-24 mx-auto" onerror="this.style.display='none'">
                <h2 class="text-xl font-bold text-teal-600">CVC Early Warning System</h2>
                <p class="text-sm text-gray-500">Versi 2.2.0 | 2026</p>
                <p class="text-sm text-gray-600 text-justify">Aplikasi sistem peringatan dini untuk deteksi komplikasi kateter vena sentral (CVC) pada pasien.</p>
            </div>
        </div>
    </div>

    <!-- HEADER -->
    <header class="app-header">
        <div class="header-container">
            <div class="brand" onclick="openModal('infoModal')">
                <img src="https://raw.githubusercontent.com/bumimadinahdb26-cloud/cvcare/main/logo.png" alt="Logo" class="brand-logo" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'40\' height=\'40\' viewBox=\'0 0 24 24\' fill=\'none\' stroke=\'%230d9488\' stroke-width=\'2\'%3E%3Ccircle cx=\'12\' cy=\'12\' r=\'10\'/%3E%3Cpath d=\'M12 6v6l4 2\'/%3E%3C/svg%3E'">
                <div class="brand-text">
                    <h1>CVC Early Warning</h1>
                    <p>System v2.2</p>
                </div>
            </div>

            <div class="flex items-center gap-2">
                <!-- Language Switcher (Visible Desktop only) -->
                <div class="hidden sm:flex items-center gap-1 bg-gray-100 p-1 rounded-full">
                    <button onclick="setLanguage('id')" id="langId" class="px-3 py-1 text-xs font-semibold rounded-full text-gray-500 hover:bg-white transition">ID</button>
                    <button onclick="setLanguage('en')" id="langEn" class="px-3 py-1 text-xs font-semibold rounded-full text-gray-500 hover:bg-white transition">EN</button>
                </div>

                <!-- Voice Button -->
                <button onclick="toggleVoice()" class="p-2 rounded-full hover:bg-gray-100" title="Suara">
                    <svg id="voiceIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>
                </button>

                <!-- Login/User Area -->
                <div id="loggedOutView">
                    <button onclick="openModal('loginModal')" class="btn btn-sm btn-primary">Login</button>
                </div>

                <div id="loggedInView" class="hidden dropdown">
                    <button onclick="toggleDropdown()" class="flex items-center gap-2 p-1 pr-3 rounded-full hover:bg-gray-100">
                        <img id="headerAvatar" src="data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'32\' height=\'32\' viewBox=\'0 0 24 24\' fill=\'none\' stroke=\'%2364748b\' stroke-width=\'2\'%3E%3Cpath d=\'M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\'/%3E%3Ccircle cx=\'12\' cy=\'7\' r=\'4\'/%3E%3C/svg%3E" class="w-8 h-8 rounded-full bg-gray-100">
                        <span id="headerName" class="text-sm font-semibold text-gray-700 hidden sm:block">User</span>
                    </button>
                    <div id="userDropdown" class="dropdown-menu">
                        <div class="dropdown-item" onclick="openModal('infoModal')"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg> Info</div>
                        <div class="dropdown-item" onclick="switchTab('riwayat')"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> Riwayat</div>
                        <div class="dropdown-item text-red-500" onclick="handleLogout()"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg> Keluar</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- NAVIGATION -->
    <nav class="app-nav">
        <div class="nav-container">
            <div class="nav-item active" data-tab="assessment" onclick="switchTab('assessment')">Penilaian</div>
            <div class="nav-item" data-tab="results" onclick="switchTab('results')">Hasil</div>
            <div class="nav-item" data-tab="panduan" onclick="switchTab('panduan')">Panduan</div>
            <div class="nav-item" data-tab="privacy" onclick="switchTab('privacy')">Privasi</div>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        
        <!-- ASSESSMENT SECTION -->
        <div id="assessment-section" class="section active">
            
            <!-- Patient Data -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg> Data Pasien</div>
                </div>
                <div class="card-body">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ID Pasien</label>
                            <input type="text" id="patientId" class="form-input" placeholder="RM-xxxxx">
                        </div>
                        <div class="form-group">
                            <label>Nama Pasien</label>
                            <input type="text" id="patientNameInput" class="form-input" placeholder="Nama lengkap">
                        </div>
                        <div class="form-group">
                            <label>Usia</label>
                            <input type="number" id="patientAge" class="form-input" placeholder="Tahun">
                        </div>
                        <div class="form-group">
                            <label>Instalasi</label>
                            <select id="instalasi" class="form-input">
                                <option value="">Pilih...</option>
                                <option>Rawat Inap</option>
                                <option>ICU</option>
                                <option>ICCU</option>
                                <option>IGD</option>
                                <option>Hemodialisa</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ruang</label>
                            <input type="text" id="ruang" class="form-input" placeholder="No. Ruang">
                        </div>
                        <div class="form-group">
                            <label>Lama Terpasang (Hari)</label>
                            <input type="number" id="daysInserted" class="form-input" placeholder="Hari ke-">
                        </div>
                    </div>
                    <div class="mt-6 pt-6 border-t border-gray-100 grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-group">
                            <label>Lokasi Kateter</label>
                            <select id="cvcLocation" class="form-input" onchange="calculateRisk()">
                                <option value="internal-jugular">Leher (Internal Jugular)</option>
                                <option value="femoral">Paha (Femoral)</option>
                                <option value="subclavian">Dada (Subclavian)</option>
                            </select>
                        </div>
                        <div class="flex items-end gap-4 pb-1">
                            <label class="flex items-center gap-2 cursor-pointer text-sm text-gray-600">
                                <input type="checkbox" id="diabetes" onchange="calculateRisk()" class="w-4 h-4 accent-teal-600"> Diabetes
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer text-sm text-gray-600">
                                <input type="checkbox" id="lowAlbumin" onchange="calculateRisk()" class="w-4 h-4 accent-teal-600"> Albumin Rendah
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer text-sm text-gray-600">
                                <input type="checkbox" id="immunocompromised" onchange="calculateRisk()" class="w-4 h-4 accent-teal-600"> Imun Lemah
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Symptoms -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Infection -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title text-red-600"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg> Tanda Infeksi</div>
                        <span id="infectionBadge" class="badge badge-low">Low</span>
                    </div>
                    <div class="card-body">
                        <h4 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">Infeksi Lokal</h4>
                        <div class="symptom-grid mb-6">
                            <label class="check-card"><input type="checkbox" id="erythema" onchange="calculateRisk()"><div class="content"><div class="check-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"><polyline points="20 6 9 17 4 12"></polyline></svg></div><span class="text-sm font-medium">Kemerahan</span></div></label>
                            <label class="check-card"><input type="checkbox" id="swelling" onchange="calculateRisk()"><div class="content"><div class="check-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"><polyline points="20 6 9 17 4 12"></polyline></svg></div><span class="text-sm font-medium">Bengkak/Hangat</span></div></label>
                            <label class="check-card"><input type="checkbox" id="purulent" onchange="calculateRisk()"><div class="content"><div class="check-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"><polyline points="20 6 9 17 4 12"></polyline></svg></div><span class="text-sm font-medium">Keluar Nanah</span></div></label>
                            <label class="check-card"><input type="checkbox" id="tenderness" onchange="calculateRisk()"><div class="content"><div class="check-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"><polyline points="20 6 9 17 4 12"></polyline></svg></div><span class="text-sm font-medium">Nyeri Tekan</span></div></label>
                            <label class="check-card"><input type="checkbox" id="tunnelInfection" onchange="calculateRisk()"><div class="content"><div class="check-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"><polyline points="20 6 9 17 4 12"></polyline></svg></div><span class="text-sm font-medium">Infeksi Terowongan</span></div></label>
                        </div>
                        <h4 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">Infeksi Sistemik</h4>
                        <div class="symptom-grid">
                            <label class="check-card"><input type="checkbox" id="fever" onchange="calculateRisk()"><div class="content"><div class="check-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"><polyline points="20 6 9 17 4 12"></polyline></svg></div><span class="text-sm font-medium">Demam >38C</span></div></label>
                            <label class="check-card"><input type="checkbox" id="chills" onchange="calculateRisk()"><div class="content"><div class="check-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"><polyline points="20 6 9 17 4 12"></polyline></svg></div><span class="text-sm font-medium">Menggigil</span></div></label>
                            <label class="check-card"><input type="checkbox" id="hypotension" onchange="calculateRisk()"><div class="content"><div class="check-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"><polyline points="20 6 9 17 4 12"></polyline></svg></div><span class="text-sm font-medium">Hipotensi</span></div></label>
                            <label class="check-card"><input type="checkbox" id="leukocytosis" onchange="calculateRisk()"><div class="content"><div class="check-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"><polyline points="20 6 9 17 4 12"></polyline></svg></div><span class="text-sm font-medium">Leukositosis</span></div></label>
                            <label class="check-card"><input type="checkbox" id="malaise" onchange="calculateRisk()"><div class="content"><div class="check-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"><polyline points="20 6 9 17 4 12"></polyline></svg></div><span class="text-sm font-medium">Lemas</span></div></label>
                        </div>
                    </div>
                </div>

                <!-- Dysfunction -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title text-orange-600"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg> Gangguan Aliran</div>
                        <span id="dysfunctionBadge" class="badge badge-low">Low</span>
                    </div>
                    <div class="card-body">
                        <div class="symptom-grid">
                            <label class="check-card"><input type="checkbox" id="lowFlow" onchange="calculateRisk()"><div class="content"><div class="check-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"><polyline points="20 6 9 17 4 12"></polyline></svg></div><span class="text-sm font-medium">Aliran Lambat</span></div></label>
                            <label class="check-card"><input type="checkbox" id="arterialAlarm" onchange="calculateRisk()"><div class="content"><div class="check-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"><polyline points="20 6 9 17 4 12"></polyline></svg></div><span class="text-sm font-medium">Alarm Tarikan</span></div></label>
                            <label class="check-card"><input type="checkbox" id="venousAlarm" onchange="calculateRisk()"><div class="content"><div class="check-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"><polyline points="20 6 9 17 4 12"></polyline></svg></div><span class="text-sm font-medium">Alarm Kembalian</span></div></label>
                            <label class="check-card"><input type="checkbox" id="flushDifficulty" onchange="calculateRisk()"><div class="content"><div class="check-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"><polyline points="20 6 9 17 4 12"></polyline></svg></div><span class="text-sm font-medium">Sulit Disuntik</span></div></label>
                            <label class="check-card"><input type="checkbox" id="positionDependent" onchange="calculateRisk()"><div class="content"><div class="check-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"><polyline points="20 6 9 17 4 12"></polyline></svg></div><span class="text-sm font-medium">Posisi Tergantung</span></div></label>
                            <label class="check-card"><input type="checkbox" id="visibleClot" onchange="calculateRisk()"><div class="content"><div class="check-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"><polyline points="20 6 9 17 4 12"></polyline></svg></div><span class="text-sm font-medium">Gumpalan Darah</span></div></label>
                            <label class="check-card"><input type="checkbox" id="recirculation" onchange="calculateRisk()"><div class="content"><div class="check-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"><polyline points="20 6 9 17 4 12"></polyline></svg></div><span class="text-sm font-medium">Resirkulasi Tinggi</span></div></label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex flex-col sm:flex-row justify-center gap-3 mt-8">
                <button class="btn btn-primary" onclick="calculateRisk()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="4" y="4" width="16" height="16" rx="2"></rect><path d="M9 9h6M9 12h6M9 15h4"></path></svg>
                    Hitung Skor Risiko
                </button>
                <button class="btn btn-outline" onclick="resetForm()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path></svg>
                    Reset Form
                </button>
            </div>
        </div>

        <!-- RESULTS SECTION -->
        <div id="results-section" class="section">
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Score Display -->
                <div class="card">
                    <div class="card-header"><div class="card-title">Total Skor</div></div>
                    <div class="card-body flex flex-col items-center justify-center py-10">
                        <div class="relative w-40 h-40">
                            <svg class="progress-ring w-full h-full" viewBox="0 0 100 100">
                                <circle class="text-gray-200" stroke-width="10" stroke="currentColor" fill="transparent" r="40" cx="50" cy="50"/>
                                <circle id="progressCircle" class="progress-circle text-teal-500" stroke-width="10" stroke="currentColor" fill="transparent" r="40" cx="50" cy="50" stroke-dasharray="251.2" stroke-dashoffset="251.2" stroke-linecap="round"/>
                            </svg>
                            <div class="absolute inset-0 flex flex-col items-center justify-center">
                                <span id="totalScore" class="text-4xl font-bold text-gray-800">0</span>
                                <span class="text-sm text-gray-500">poin</span>
                            </div>
                        </div>
                        <div id="overallBadge" class="badge badge-low mt-4 text-base px-6 py-1">LOW RISK</div>
                        <p id="riskSummary" class="mt-3 text-sm text-gray-500 text-center">Risiko Rendah. Pemantauan rutin.</p>
                    </div>
                </div>

                <!-- Details -->
                <div class="card lg:col-span-2">
                    <div class="card-header"><div class="card-title">Rincian Risiko</div></div>
                    <div class="card-body space-y-6">
                        <div>
                            <div class="flex justify-between mb-1"><span class="text-sm font-medium">Risiko Infeksi</span><span id="infectionScoreDisplay" class="text-sm font-bold text-red-500">0/15</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5"><div id="infectionBar" class="bg-red-400 h-2.5 rounded-full" style="width: 0%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1"><span class="text-sm font-medium">Gangguan Aliran</span><span id="dysfunctionScoreDisplay" class="text-sm font-bold text-orange-500">0/14</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5"><div id="dysfunctionBar" class="bg-orange-400 h-2.5 rounded-full" style="width: 0%"></div></div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1"><span class="text-sm font-medium">Faktor Pasien</span><span id="patientScoreDisplay" class="text-sm font-bold text-purple-500">0/8</span></div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5"><div id="patientBar" class="bg-purple-400 h-2.5 rounded-full" style="width: 0%"></div></div>
                        </div>
                        
                        <div class="pt-4 border-t">
                            <h4 class="text-sm font-semibold mb-2">Temuan</h4>
                            <div id="findingsList" class="text-sm text-gray-600"><p class="italic text-gray-400">Belum ada temuan.</p></div>
                        </div>
                        
                        <div class="pt-4 border-t">
                             <h4 class="text-sm font-semibold mb-2">Saran Tindakan</h4>
                             <div id="recommendationsContent" class="p-4 bg-green-50 text-green-800 rounded-lg text-sm">Lanjutkan pemantauan rutin.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Send Report -->
            <div class="card mt-6 border-purple-100 bg-gradient-to-r from-purple-50/50 to-teal-50/50">
                <div class="card-header border-purple-100">
                    <div class="card-title text-purple-700">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="#8b5cf6"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.94 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.372-.025-.52-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479c0 1.462 1.065 2.875 1.213 3.074.149.198 2.095 3.2 5.076 4.487 1.054.453 1.875.709 2.51.903.999.306 1.905.26 2.623.159.801-.112 2.468-1.009 2.817-1.984.349-.976.349-1.81.245-1.984-.074-.124-.272-.198-.57-.347z"/></svg>
                        Kirim Laporan
                    </div>
                    <span class="text-xs text-green-600 font-semibold bg-green-100 px-2 py-1 rounded hidden sm:block">Database Terhubung</span>
                </div>
                <div class="card-body space-y-4">
                    <div>
                        <p class="text-xs font-bold text-gray-400 uppercase mb-2">Perawat</p>
                        <div class="contact-grid">
                            <div class="contact-card"><div class="font-medium text-sm">Riza</div><button onclick="sendWhatsApp('6282227707573')" class="btn-wa">Kirim</button></div>
                            <div class="contact-card"><div class="font-medium text-sm">Pembayun</div><button onclick="sendWhatsApp('6283831217784')" class="btn-wa">Kirim</button></div>
                            <div class="contact-card"><div class="font-medium text-sm">Hesty</div><button onclick="sendWhatsApp('6282124700093')" class="btn-wa">Kirim</button></div>
                            <div class="contact-card"><div class="font-medium text-sm">Rinda</div><button onclick="sendWhatsApp('6285210622568')" class="btn-wa">Kirim</button></div>
                            <div class="contact-card"><div class="font-medium text-sm">Iman</div><button onclick="sendWhatsApp('6287812203039')" class="btn-wa">Kirim</button></div>
                        </div>
                    </div>
                    <div>
                        <p class="text-xs font-bold text-gray-400 uppercase mb-2">Dokter</p>
                        <div class="contact-grid">
                            <div class="contact-card border-red-100 bg-red-50/50"><div class="font-medium text-sm">dr. Achmad Rifai</div><button onclick="sendWhatsApp('6281252651083')" class="btn-wa bg-red-100 text-red-700 border-red-200 hover:bg-red-500 hover:text-white">Kirim</button></div>
                        </div>
                    </div>
                    <div class="pt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <button onclick="sendToSpreadsheet()" class="btn btn-primary btn-sm"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg> Simpan ke DB</button>
                        <button onclick="saveToHistory()" class="btn btn-outline btn-sm"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg> Simpan Riwayat</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIWAYAT SECTION -->
        <div id="riwayat-section" class="section">
            <div class="card">
                <div class="card-header justify-between">
                    <div class="card-title">Riwayat Saya</div>
                    <button onclick="clearHistory()" class="text-red-500 text-xs hover:underline">Hapus Semua</button>
                </div>
                <div class="card-body" id="historyContainer">
                    <p class="text-gray-400 text-center py-8">Belum ada riwayat.</p>
                </div>
            </div>
        </div>

        <!-- PANDUAN SECTION -->
        <div id="panduan-section" class="section">
            <div class="card">
                <div class="card-header justify-between">
                    <div class="card-title">Panduan Penggunaan</div>
                    <button onclick="readGuide()" class="btn btn-outline btn-sm"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg> Baca</button>
                </div>
                <div class="card-body space-y-4 text-sm text-gray-700">
                    <div><h4 class="font-bold text-teal-700 mb-1">1. Membuat Akun</h4><p>Klik Login/Daftar di pojok kanan atas untuk menyimpan riwayat pribadi.</p></div>
                    <div><h4 class="font-bold text-teal-700 mb-1">2. Pengkajian</h4><p>Isi data pasien dan centang gejala yang ditemukan. Sistem otomatis menghitung skor.</p></div>
                    <div><h4 class="font-bold text-teal-700 mb-1">3. Laporan</h4><p>Lihat hasil di tab 'Hasil', lalu pilih kontak untuk mengirim laporan via WhatsApp.</p></div>
                </div>
            </div>
            <div class="card mt-6">
                <div class="card-header"><div class="card-title">Video Edukasi</div></div>
                <div class="card-body"><div class="aspect-video bg-gray-100 rounded-lg overflow-hidden"><iframe src="https://drive.google.com/file/d/16_RQIDh7VcxzXJw_-dmkdnAANP0pZg8x/preview" width="100%" height="100%" allow="autoplay"></iframe></div></div>
            </div>
        </div>

        <!-- PRIVACY SECTION -->
        <div id="privacy-section" class="section">
            <div class="card">
                <div class="card-header"><div class="card-title">Kebijakan Privasi</div></div>
                <div class="card-body text-sm text-gray-600 space-y-4">
                    <p>Aplikasi CVC Early Warning System menghormati privasi pengguna. Data pasien disimpan secara lokal di perangkat pengguna (Local Storage) dan dapat disinkronkan ke database instansi kesehatan terkait.</p>
                    <p class="text-xs text-gray-400">Versi 2.2.0 | 2026</p>
                </div>
            </div>
        </div>

    </main>

    <footer class="text-center py-6 text-xs text-gray-400 border-t bg-white">
        2026 &copy; CVC Early Warning System - Created by Iman Waluyo
    </footer>

    <script>
        // ========== LOGIC ==========
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxl-fqugmRI92spOhrVmQ-nyEHiyRJUMQwpJQm12ITo4JZdUBOaliXaQ9GR6bYdzSO5TA/exec';
        let currentLang = 'id';
        let currentUser = null;
        let infectionScore = 0, dysfunctionScore = 0, patientRiskScore = 0, durationScore = 0;
        let voiceEnabled = false;
        const synth = window.speechSynthesis;

        document.addEventListener('DOMContentLoaded', () => {
            loadUser();
            setLanguage('id');
            calculateRisk();
        });

        // UI Interactions
        function switchTab(tabId) {
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.querySelector(`.nav-item[data-tab="${tabId}"]`).classList.add('active');
            document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
            document.getElementById(`${tabId}-section`).classList.add('active');
            window.scrollTo(0,0);
        }
        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        function switchModal(from, to) { closeModal(from); setTimeout(() => openModal(to), 100); }
        function toggleDropdown() { document.getElementById('userDropdown').classList.toggle('active'); }
        document.addEventListener('click', (e) => {
            if (!document.getElementById('loggedInView')?.contains(e.target)) document.getElementById('userDropdown')?.classList.remove('active');
        });

        // Language
        function setLanguage(lang) {
            currentLang = lang;
            document.getElementById('langId').classList.toggle('bg-teal-600', lang === 'id');
            document.getElementById('langId').classList.toggle('text-white', lang === 'id');
            document.getElementById('langEn').classList.toggle('bg-teal-600', lang === 'en');
            document.getElementById('langEn').classList.toggle('text-white', lang === 'en');
        }

        // Voice
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            document.getElementById('voiceIcon').style.stroke = voiceEnabled ? '#8b5cf6' : '#64748b';
            if(voiceEnabled) speak(currentLang === 'id' ? 'Mode suara aktif' : 'Voice mode active');
        }
        function speak(text) { if(voiceEnabled) synth.speak(new SpeechSynthesisUtterance(text)); }
        function readGuide() { speak('Panduan penggunaan. Isi data pasien, pilih gejala, hitung skor, kirim laporan.'); }

        // Auth
        function loadUser() {
            const u = localStorage.getItem('cvcUser');
            if(u) { currentUser = JSON.parse(u); showLoggedIn(); }
        }
        function showLoggedIn() {
            document.getElementById('loggedOutView').classList.add('hidden');
            document.getElementById('loggedInView').classList.remove('hidden');
            document.getElementById('headerName').textContent = currentUser.name;
        }
        function showLoggedOut() {
            document.getElementById('loggedOutView').classList.remove('hidden');
            document.getElementById('loggedInView').classList.add('hidden');
        }
        function handleLogin() {
            const u = document.getElementById('loginUsername').value;
            const p = document.getElementById('loginPassword').value;
            const users = JSON.parse(localStorage.getItem('cvcUsers') || '[]');
            const found = users.find(x => x.username === u && x.password === p);
            if(found) {
                currentUser = found;
                localStorage.setItem('cvcUser', JSON.stringify(found));
                showLoggedIn();
                closeModal('loginModal');
            } else alert('Login gagal');
        }
        function handleRegister() {
            const name = document.getElementById('registerName').value;
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            if(!name || !username || !password) return alert('Lengkapi data');
            let users = JSON.parse(localStorage.getItem('cvcUsers') || '[]');
            if(users.find(x => x.username === username)) return alert('Username ada');
            users.push({name, username, password});
            localStorage.setItem('cvcUsers', JSON.stringify(users));
            alert('Daftar sukses, silakan login');
            switchModal('registerModal', 'loginModal');
        }
        function handleLogout() {
            localStorage.removeItem('cvcUser');
            currentUser = null;
            showLoggedOut();
        }

        // Calculation
        function calculateRisk() {
            infectionScore = 0;
            ['erythema', 'swelling', 'purulent', 'tenderness', 'tunnelInfection'].forEach(i => { if(document.getElementById(i)?.checked) infectionScore += 2 });
            ['fever', 'chills', 'hypotension', 'leukocytosis', 'malaise'].forEach(i => { if(document.getElementById(i)?.checked) infectionScore += 3 });
            
            dysfunctionScore = 0;
            ['lowFlow', 'arterialAlarm', 'venousAlarm', 'flushDifficulty', 'positionDependent', 'visibleClot', 'recirculation'].forEach(i => { if(document.getElementById(i)?.checked) dysfunctionScore += 2 });

            patientRiskScore = 0;
            if(document.getElementById('diabetes')?.checked) patientRiskScore += 2;
            if(document.getElementById('lowAlbumin')?.checked) patientRiskScore += 2;
            if(document.getElementById('immunocompromised')?.checked) patientRiskScore += 2;
            if(parseInt(document.getElementById('patientAge')?.value) > 60) patientRiskScore += 1;
            if(document.getElementById('cvcLocation')?.value === 'femoral') patientRiskScore += 2;

            durationScore = 0;
            const days = parseInt(document.getElementById('daysInserted')?.value) || 0;
            if(days > 20) durationScore = 3; else if(days > 14) durationScore = 2; else if(days > 7) durationScore = 1;

            updateDisplay(infectionScore + dysfunctionScore + patientRiskScore + durationScore);
        }

        function getRiskLevel(total) {
            if(total >= 20) return { text: 'CRITICAL', color: 'red', summary: 'Kondisi Kritis! Tindakan segera.' };
            if(total >= 12) return { text: 'HIGH', color: 'orange', summary: 'Risiko Tinggi! Evaluasi cepat.' };
            if(total >= 5) return { text: 'MODERATE', color: 'yellow', summary: 'Risiko Sedang. Pantau ketat.' };
            return { text: 'LOW', color: 'green', summary: 'Risiko Rendah. Pemantauan rutin.' };
        }

        function updateDisplay(total) {
            document.getElementById('totalScore').textContent = total;
            const circle = document.getElementById('progressCircle');
            const pct = Math.min(total / 42, 1);
            circle.style.strokeDashoffset = 251.2 * (1 - pct);
            circle.style.stroke = total >= 20 ? '#ef4444' : total >= 12 ? '#f97316' : total >= 5 ? '#eab308' : '#10b981';

            const risk = getRiskLevel(total);
            const badge = document.getElementById('overallBadge');
            badge.textContent = risk.text;
            badge.className = `badge badge-${risk.color.toLowerCase()} mt-4 text-base px-6 py-1`;
            document.getElementById('riskSummary').textContent = risk.summary;

            updateBar('infection', infectionScore, 15);
            updateBar('dysfunction', dysfunctionScore, 14);
            updateBar('patient', patientRiskScore, 8);
            
            // Findings
            const findings = [];
            const map = {erythema:'Kemerahan', swelling:'Bengkak', purulent:'Nanah', tenderness:'Nyeri', tunnelInfection:'Infeksi Terowongan', fever:'Demam', chills:'Menggigil', hypotension:'Hipotensi', leukocytosis:'Leukositosis', malaise:'Lemas', lowFlow:'Aliran Lambat', arterialAlarm:'Alarm Tarikan', venousAlarm:'Alarm Kembalian', flushDifficulty:'Sulit Disuntik', positionDependent:'Posisi Tergantung', visibleClot:'Gumpalan', recirculation:'Resirkulasi'};
            Object.keys(map).forEach(id => { if(document.getElementById(id)?.checked) findings.push(map[id]); });
            document.getElementById('findingsList').innerHTML = findings.length ? findings.map(f=>`<span class="inline-block bg-gray-100 rounded px-2 py-1 m-1 text-xs">${f}</span>`).join('') : '<p class="italic text-gray-400">Tidak ada temuan.</p>';
            
            // Recs
            document.getElementById('recommendationsContent').className = `p-4 bg-${risk.color}-50 text-${risk.color}-800 rounded-lg text-sm`;
            document.getElementById('recommendationsContent').textContent = risk.summary;
        }

        function updateBar(cat, score, max) {
            document.getElementById(`${cat}ScoreDisplay`).textContent = `${score}/${max}`;
            const bar = document.getElementById(`${cat}Bar`);
            const w = (score/max)*100;
            bar.style.width = w+'%';
            bar.style.background = w > 70 ? '#ef4444' : w > 40 ? '#f97316' : w > 20 ? '#eab308' : '#10b981';
        }

        function resetForm() {
            document.querySelectorAll('.check-card input').forEach(c => c.checked = false);
            document.querySelectorAll('.form-input').forEach(i => i.value = '');
            document.querySelectorAll('input[type="checkbox"]:not(.check-card input)').forEach(c => c.checked = false);
            calculateRisk();
        }

        // Sending Data
        function sendWhatsApp(phone) {
            const pName = document.getElementById('patientNameInput').value || 'Unknown';
            const pId = document.getElementById('patientId').value || '-';
            const score = infectionScore + dysfunctionScore + patientRiskScore + durationScore;
            const risk = getRiskLevel(score);
            const msg = `*LAPORAN CVC EWS*\nPasien: ${pName} (${pId})\nSkor: ${score} (${risk.text})\nSaran: ${risk.summary}\n\nDari: CVC EWS App`;
            window.open(`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`, '_blank');
        }
        
        async function sendToSpreadsheet() {
            const data = {
                patientId: document.getElementById('patientId').value,
                patientName: document.getElementById('patientNameInput').value,
                score: infectionScore + dysfunctionScore + patientRiskScore + durationScore,
                level: getRiskLevel(infectionScore + dysfunctionScore + patientRiskScore + durationScore).text
            };
            try {
                await fetch(WEB_APP_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) });
                alert('Data terkirim ke database');
            } catch(e) { alert('Gagal mengirim'); }
        }

        function saveToHistory() {
            if(!currentUser) return alert('Login dulu');
            const record = { timestamp: new Date().toLocaleString('id-ID'), name: document.getElementById('patientNameInput').value, score: infectionScore + dysfunctionScore + patientRiskScore + durationScore };
            let h = JSON.parse(localStorage.getItem('cvc_user_history') || '[]');
            h.unshift(record);
            localStorage.setItem('cvc_user_history', JSON.stringify(h));
            loadHistory();
            alert('Tersimpan di riwayat');
        }
        function loadHistory() {
            const h = JSON.parse(localStorage.getItem('cvc_user_history') || '[]');
            const c = document.getElementById('historyContainer');
            c.innerHTML = h.length ? h.map(i => `<div class="p-4 border-b flex justify-between"><div><p class="font-bold">${i.name}</p><p class="text-xs text-gray-400">${i.timestamp}</p></div><span class="font-bold text-teal-600">${i.score}</span></div>`).join('') : '<p class="text-center py-8 text-gray-400">Kosong</p>';
        }
        function clearHistory() {
            if(confirm('Hapus semua?')) {
                localStorage.removeItem('cvc_user_history');
                loadHistory();
            }
        }
    </script>
</body>
</html>
